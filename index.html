

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹±í¬ëŒ€ ê²¬ì ì„œ</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    .container {
      display: flex;
      gap: 20px;
    }

    .panel {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
      min-height: 600px;
    }

   .left {
  width: 220px;
}

.flex-row {
  display: flex;
  flex-direction: row;
  gap: 20px;
  width: 100%;
  flex-wrap: nowrap; /* âœ… ì¤„ë°”ê¿ˆ ë°©ì§€ */
}

#upperForm, #lowerForm {
  flex: 1;
  min-width: 0; /* âœ… flex ìš”ì†Œ ì¤„ë°”ê¿ˆ ë°©ì§€ */
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.right {
  width: 300px;
}

h3 {
  text-align: center;
  margin-top: 0;
}

h4 {
  margin: 0;
  padding: 0;
}

    .admin-button {
      display: block;
      width: 100%;
      padding: 10px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 20px;
      cursor: pointer;
    }

    .category-group { margin-bottom: 20px; }
    .category-title { font-weight: bold; margin-bottom: 6px; }

    .category-item {
      display: inline-block;
      background-color: #eef2f7;
      padding: 6px 10px;
      margin: 4px 4px 0 0;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .section { width: 100%; margin-bottom: 20px; display: none; }
    .radio-group label { display: block; margin-bottom: 8px; font-size: 16px; }

    .size-inputs {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .size-inputs input {
      width: 100px;
      padding: 8px;
      font-size: 16px;
    }

    #unitPriceInput, #saveUnitBtn {
      display: none;
      margin-top: 10px;
    }

    .add-button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }

    .add-button:hover { background-color: #555; }

    .admin-panel {
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 12px;
      border-radius: 8px;
      background-color: #fafafa;
      font-size: 14px;
    }

    .admin-panel input[type="text"],
    .admin-panel input[type="number"] {
      width: 100%;
      margin-bottom: 8px;
      padding: 6px;
      font-size: 14px;
    }

    .admin-panel input[type="file"] {
      margin-bottom: 8px;
    }

    .admin-panel button {
      padding: 6px 10px;
      margin-top: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    #estimateList {
      margin-top: 10px;
      font-size: 14px;
      line-height: 1.6;
    }
#upperForm, #lowerForm {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#artificialTopSection.full-width {
    display: flex !important;
    flex-direction: column;
    flex: 1 !important;
    gap: 20px;
  }
.material-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.material-grid.small {
  grid-template-columns: repeat(2, 1fr);  /* âœ… 2ê°œì”© */
}

.material-card {
  position: relative; /* âœ… BEST ë¼ë²¨ì„ ë‚´ë¶€ì— ê³ ì •ì‹œí‚¤ê¸° ìœ„í•´ í•„ìš” */
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  background: #fff;
  text-align: center;
  font-size: 14px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.material-card img {
  width: 100%;
  height: 250px;
  object-fit: contain;
  background-color: #fff;
  padding: 10px;
}
#selectedMaterialPreview {
  display: flex;
  align-items: center;
  justify-content: center;  /* âœ… ê°€ìš´ë° ì •ë ¬ ìœ ì§€ */
  gap: 20px;
  margin: 20px 0;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background: #fefefe;
  min-height: 240px;
  width: auto;
max-width: 300px;
}
#selectedMaterialPreview img {
  width: 200px;
  height: 200px;
  object-fit: cover;
  border-radius: 10px;
  border: 1px solid #ccc;
}
#selectedMaterialPreview strong {
  font-size: 20px;
}
.material-preview-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}
.price-edit-box {
  display: none;
  justify-content: center;
  align-items: center;
  gap: 4px;
}

/* âœ… BEST ë¼ë²¨ ìŠ¤íƒ€ì¼ */
.best-label {
  position: absolute;
  top: 6px;
  left: 6px;
  background-color: gold;
  color: white; /* âœ… ê¸€ì ìƒ‰ìƒ í°ìƒ‰ */
  font-size: 12px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 4px;
  z-index: 2;
}

/* âœ… ê¸°ë³¸í˜• ë¼ë²¨ */
.basic-label {
  position: absolute;
  top: 6px;
  left: 60px;
  background-color: #007bff;
  color: white;
  font-size: 12px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 4px;
  z-index: 2;
}

@media (max-width: 1024px) {
  .container {
    flex-direction: column;
    gap: 12px;
  }

  .panel.left {
    width: 100%;
    order: 1;
  }

  .flex-row {
    flex-direction: row;
    flex-wrap: nowrap;
    gap: 12px;
    order: 2;
    overflow-x: auto;
  }

  .panel[data-panel="upper"],
  .panel[data-panel="lower"],
  #artificialTopSection,
  .panel[id^="customEtcPanel"],
  #customKeyPanel,
  #customFridgePanel {
    flex: 0 0 50%;
    min-width: 320px;
  }

  .panel.right {
    width: 100%;
    order: 3;
  }

  .material-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
  </style>
</head>
<body>
  <div class="container">
    <!-- ì¢Œì¸¡ -->
    <div class="panel left">
  <h3>ìì¬ ì¹´í…Œê³ ë¦¬</h3>
  <button class="admin-button" onclick="promptPassword()">ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ</button>

  <div class="category-group">
    <div class="category-title">ìƒë¶€ì¥</div>
    <div class="category-item" onclick="selectCategory('ìƒë¶€ì¥', 'LPM')">LPM</div>
    <div class="category-item" onclick="selectCategory('ìƒë¶€ì¥', 'PET')">PET</div>
  </div>

  <div class="category-group">
    <div class="category-title">í•˜ë¶€ì¥</div>
    <div class="category-item" onclick="selectCategory('í•˜ë¶€ì¥', 'LPM')">LPM</div>
    <div class="category-item" onclick="selectCategory('í•˜ë¶€ì¥', 'PET')">PET</div>
  </div>

  <div class="category-group">
    <div class="category-title">ê¸°íƒ€</div>
    <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'í‚¤í°ì¥')">í‚¤í°ì¥</div>
    <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'ëƒ‰ì¥ê³ ì¥')">ëƒ‰ì¥ê³ ì¥</div>
  </div>

  <div class="category-group">
    <div class="category-title">ì¸ì¡°ëŒ€ë¦¬ì„ ìƒíŒ</div>
    <div class="category-item" onclick="selectCategory('ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ', 'LXí•˜ì´ë§‰ìŠ¤')">LXí•˜ì´ë§‰ìŠ¤</div>
    <div class="category-item" onclick="selectCategory('ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ', 'ì˜¤ë¡œë¼')">ì˜¤ë¡œë¼</div>
    <div class="category-item" onclick="selectCategory('ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ', 'ì¹¸ìŠ¤í†¤')">ì¹¸ìŠ¤í†¤</div>
  </div>

  <!-- âœ… êµ¬ë¶„ì„  -->
  <hr style="margin: 16px 0; border: none; border-top: 1px solid #aaa;" />

  <!-- âœ… ì¶”ê°€ ì¹´í…Œê³ ë¦¬ -->
  <div class="category-group">
    <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'í›„ë“œ')">í›„ë“œ</div>
    <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'ì‹±í¬ë³¼')">ì‹±í¬ë³¼</div>
    <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'ì‹±í¬ìˆ˜ì „')">ì‹±í¬ìˆ˜ì „</div>
  <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'ì¿¡íƒ‘')">ì¿¡íƒ‘</div>
  <div class="category-item" onclick="selectCategory('ê¸°íƒ€', 'ì½˜ì„¼íŠ¸')">ì½˜ì„¼íŠ¸</div>
</div>
</div>

    <!-- ì¤‘ì•™ + ìš°ì¸¡ -->
    <div class="flex-row" style="width: 100%;">
      <!-- ìƒë¶€ì¥ ìì¬ ëª©ë¡ íŒ¨ë„ -->
      <div class="panel" style="flex: 0 0 32%;" data-panel="upper">
  <h3>ìì¬ ëª©ë¡ (ìƒë¶€ì¥)</h3>
  <div id="upperForm">
    <div class="section" id="upperFormSection">
      <div>
        <h4 id="upperShapeTitle">í˜•íƒœ ì„ íƒ (ìƒë¶€ì¥)</h4>
        <div class="radio-group" id="upperShapeOptions">
          <label><input type="radio" name="upperShape" value="1" onclick="updateSizeInputs('upper', 1)"> ä¸€ìí˜•</label>
          <label><input type="radio" name="upperShape" value="2" onclick="updateSizeInputs('upper', 2)"> ã„±ìí˜•</label>
          <label><input type="radio" name="upperShape" value="3" onclick="updateSizeInputs('upper', 3)"> ã„·ìí˜•</label>
        </div>
      </div>

      <div class="section" id="upperSizeSection">
  <h4>ì‚¬ì´ì¦ˆ ì…ë ¥</h4>
  <div style="display: flex; align-items: center; gap: 10px;">
  <div class="size-inputs" id="upperSizeInputs"></div>
  <button onclick="addUpperSizeOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
</div>

<hr style="margin: 12px 0; border: none; border-top: 1px solid #ccc;" />

<div class="unit-price-group" style="display: none;">
    <input type="number" id="upperUnitPriceInput" placeholder="ë‹¨ê°€ (ì›)" />
    <button id="upperSaveUnitBtn" onclick="saveUnitPrice('upper')">ğŸ’¾ ì €ì¥</button>
  </div>

<div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
  <div style="display: flex; gap: 10px;">
    <label>600ì¸¡íŒ:</label>
    <input type="number" id="upperSide600Input" placeholder="ê°œìˆ˜" style="width: 80px;" />
  </div>
  <div style="display: flex; gap: 10px;">
    <label>ë¹„ê·œê²© ì¸¡íŒ:</label>
    <input type="number" id="upperSideCustomInput" placeholder="ê°œìˆ˜" style="width: 80px;" />
  <button onclick="addUpperSideCustomOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
</div>
</div>

<!-- âœ… êµ¬ë¶„ì„ ê³¼ ë¼ë²¨ì€ ë°”ê¹¥ìœ¼ë¡œ ë¹¼ê¸° -->
<hr style="margin: 16px 0; border: none; border-top: 1px solid #ccc;" />

<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
  <span style="font-size: 15px; font-weight: normal;">ìƒë¶€ì¥ ê°„ì ‘ì¡°ëª…</span>
  <input type="checkbox" id="upperLightingCheckbox" />
<button onclick="addUpperLightingOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
</div>

  <button class="add-button" onclick="addToEstimate('upper')">ê²¬ì ì— ì¶”ê°€</button>
</div>

      <!-- âœ… ìì¬ ì¹´ë“œ í‘œì‹œ ì˜ì—­ -->
      <div id="upperMaterialList" class="material-grid small"></div>
    </div>
  </div>
</div>


<!-- í•˜ë¶€ì¥ ìì¬ ëª©ë¡ íŒ¨ë„ -->
<div class="panel" style="flex: 0 0 32%;" data-panel="lower">
  <h3>ìì¬ ëª©ë¡ (í•˜ë¶€ì¥)</h3>
  <div id="lowerForm">
    <div class="section" id="lowerFormSection">
      <div>
        <h4 id="lowerShapeTitle">í˜•íƒœ ì„ íƒ (í•˜ë¶€ì¥)</h4>
        <div class="radio-group" id="lowerShapeOptions">
  <label><input type="radio" name="lowerShape" value="1" onclick="updateSizeInputs('lower', 1)"> ä¸€ìí˜•</label>
  <label><input type="radio" name="lowerShape" value="2" onclick="updateSizeInputs('lower', 2)"> ã„±ìí˜•</label>
  <label><input type="radio" name="lowerShape" value="3" onclick="updateSizeInputs('lower', 3)"> ã„·ìí˜•</label>
</div>
      </div>

      <div class="section" id="lowerSizeSection">
  <h4>ì‚¬ì´ì¦ˆ ì…ë ¥</h4>
  <div style="display: flex; align-items: center; gap: 10px;">
    <div class="size-inputs" id="lowerSizeInputs"></div>
    <button onclick="addLowerSizeOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
  </div>

<hr style="margin: 12px 0; border: none; border-top: 1px solid #ccc;" />

  <div class="unit-price-group" style="display: none;">
    <input type="number" id="lowerUnitPriceInput" placeholder="ë‹¨ê°€ (ì›)" />
    <button id="lowerSaveUnitBtn" onclick="saveUnitPrice('lower')">ğŸ’¾ ì €ì¥</button>
  </div>

<div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
  <div style="display: flex; gap: 10px;">
    <label>600ì¸¡íŒ:</label>
    <input type="number" id="lowerSide600Input" placeholder="ê°œìˆ˜" style="width: 80px;" />
  </div>
  <div style="display: flex; gap: 10px;">
  <label>ë¹„ê·œê²© ì¸¡íŒ:</label>
  <input type="number" id="lowerSideCustomInput" placeholder="ê°œìˆ˜" style="width: 80px;" />
  <button onclick="addLowerSidePanelsOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
</div>

<hr style="margin: 12px 0; border: none; border-top: 1px solid #ccc;" />
</div>

        <!-- âœ… ì„œëì¥ ì…ë ¥ì¹¸ ì¶”ê°€ -->
  <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 10px;">
  <!-- âœ… ìƒë‹¨: ì„œëì¥ ê¸¸ì´ ì…ë ¥ -->
  <div style="display: flex; align-items: center; gap: 10px;">
  <label style="white-space: nowrap;">ì„œëì¥:</label>
  <input type="number" id="drawerInput" placeholder="ì„œëì¥ ê¸¸ì´ (mm)" style="width: 120px; padding: 8px; font-size: 16px;" />
  <button onclick="addLowerDrawerOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
</div>

  <!-- âœ… ì¤‘ê°„: ë‹¨ìˆ˜ ì„ íƒ -->
  <div style="display: flex; gap: 10px;">
    <label><input type="checkbox" id="twoTier"> 2ë‹¨</label>
    <label><input type="checkbox" id="threeTier"> 3ë‹¨</label>
  </div>

  <!-- âœ… í•˜ë‹¨: ë ˆì¼ ì„ íƒ -->
  <div style="display: flex; gap: 10px;">
    <label><input type="checkbox" id="ballRail"> ë³¼ë ˆì¼</label>
    <label><input type="checkbox" id="underRail"> ì–¸ë”ë ˆì¼</label>
  </div>

<hr style="margin: 12px 0; border: none; border-top: 1px solid #ccc;" />

<!-- âœ… ë°¥ì†¥ì¥ ì…ë ¥ -->
<div style="display: flex; align-items: center; gap: 10px;">
  <label style="white-space: nowrap;">ë°¥ì†¥ì¥:</label>
  <input type="number" id="riceBoxInput" placeholder="ë°¥ì†¥ì¥ ê¸¸ì´ (mm)" style="width: 120px; padding: 8px; font-size: 16px;" />
  <button onclick="addLowerRiceBoxOnly()" class="add-button" style="padding: 4px 8px; font-size: 13px;">ì¶”ê°€</button>
</div>

<!-- âœ… ë°¥ì†¥ì¥ ë ˆì¼ ì„ íƒ -->
  <div style="display: flex; gap: 10px; margin-top: 6px;">
    <label><input type="checkbox" id="riceBallRail"> ë³¼ë ˆì¼</label>
    <label><input type="checkbox" id="riceUnderRail"> ì–¸ë”ë ˆì¼</label>
</div>
</div>

  <button class="add-button" onclick="addToEstimate('lower')">ê²¬ì ì— ì¶”ê°€</button>
</div>

      <!-- âœ… ìì¬ ì¹´ë“œ í‘œì‹œ ì˜ì—­ -->
      <div id="lowerMaterialList" class="material-grid small"></div>
    </div>
  </div>
</div>

<!-- âœ… ì¸ì¡°ëŒ€ë¦¬ì„ ìƒíŒ ì „ìš© íŒ¨ë„ (í•˜ë¶€ì¥ íŒ¨ë„ ë°”ê¹¥ì— ìœ„ì¹˜í•´ì•¼ í•¨) -->
<div class="panel" style="display: none;" id="artificialTopSection">
  <h3 id="artificialTopTitle">í˜•íƒœ ì„ íƒ (ìƒíŒ)</h3>

  <!-- âœ… ë¼ë””ì˜¤ ê·¸ë£¹ + ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ ë‚˜ë€íˆ ë°°ì¹˜ -->
  <div style="display: flex; gap: 40px; align-items: flex-start;">
    <!-- ì¢Œì¸¡: ë¼ë””ì˜¤, ì‚¬ì´ì¦ˆ ì…ë ¥, ì €ì¥/ì¶”ê°€ ë²„íŠ¼ -->
    <div>
      <div class="radio-group">
        <label><input type="radio" name="artShape" value="1" onclick="updateSizeInputs('art', 1)"> ä¸€ìí˜•</label>
        <label><input type="radio" name="artShape" value="2" onclick="updateSizeInputs('art', 2)"> ã„±ìí˜•</label>
        <label><input type="radio" name="artShape" value="3" onclick="updateSizeInputs('art', 3)"> ã„·ìí˜•</label>
      </div>
      <div class="section" id="artSizeSection">
  <h4>ì‚¬ì´ì¦ˆ ì…ë ¥</h4>
  <div class="size-inputs" id="artSizeInputs"></div>
</div>
      <div class="unit-price-group" style="display: none;">
        <input type="number" id="artUnitPriceInput" placeholder="ë‹¨ê°€ (ì›)" />
        <button id="artSaveUnitBtn" onclick="saveUnitPrice('art')">ğŸ’¾ ì €ì¥</button>
      </div>
      <button class="add-button" onclick="addToEstimate('art')">ê²¬ì ì— ì¶”ê°€</button>
    </div>

    <!-- ìš°ì¸¡: ì„ íƒëœ ìì¬ ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ -->
    <div id="selectedMaterialPreview"></div>
  </div>

  <!-- í•˜ë‹¨: ìì¬ ì¹´ë“œ ëª©ë¡ -->
  <div style="margin-top: 20px; border-top: 1px solid #ccc; padding-top: 12px;">
    <strong>â€» ìì¬ ëª©ë¡ì€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</strong>
    <div id="artificialMaterialList" class="material-grid"></div>
  </div>
</div>

      <!-- âœ… ìš°ì¸¡ ê²¬ì ì„œ íŒ¨ë„ì„ ê°™ì€ ì¤„ì— ë°°ì¹˜ -->
      <div class="panel right" style="flex: 0 0 300px;">
        <h3>ê²¬ì ì„œ</h3>
        <div id="estimateList"></div>
<div id="totalCostBox" style="margin-top: 20px; font-size: 16px; font-weight: bold; text-align: right;">
  ì´ì•¡: <span id="totalCost">0</span> ì›
</div>
<button onclick="clearEstimate()" ...
<button onclick="clearEstimate()" style="margin-top:10px; background:#c00; color:white; padding:6px 10px; border:none; border-radius:4px; cursor:pointer;">ì „ì²´ ì‚­ì œ</button>
<button onclick="summarizeEstimate()" style="margin-top:10px; background:#007bff; color:white; padding:6px 10px; border:none; border-radius:4px; cursor:pointer;">ì •ë¦¬</button>

<div id="summaryBox" style="margin-top:10px; border:1px solid #ddd; padding:10px; border-radius:8px; min-height:80px; background:#fafafa;"></div>
<div id="adminPanel" class="admin-panel" style="display: none;">
  <h4>ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ</h4>

  <!-- âœ… ì´ ì¤„ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•¨ -->
  <label>í˜„ì¬ ì¹´í…Œê³ ë¦¬: <span id="currentCategoryText">-</span></label>
<br>
  <label>ìì¬ ì´ë¦„:</label>
  <input type="text" id="adminName" />

  <label>ê°€ê²©:</label>
  <input type="number" id="adminPrice" />

  <label>ì´ë¯¸ì§€ 1:</label>
  <input type="file" id="adminImgFile1" accept="image/*" />

  <label>ì´ë¯¸ì§€ 2:</label>
  <input type="file" id="adminImgFile2" accept="image/*" />

  <button onclick="uploadMaterial()">ìì¬ ì¶”ê°€í•˜ê¸°</button>
  <button onclick="closeAdminPanel()">ê´€ë¦¬ì ëª¨ë“œ ë‹«ê¸°</button>
</div>
      </div>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzEEJ9w4pDdkjI7PpECtqu_zJxICH3OCivY7JbLwuSyRlpOyc0hgVAJqaNLaDnei1jdIQ/exec";

let isAdmin = false;
let selectedMaterialName = "";
let upperCategory = "";
let lowerCategory = "";

// âœ… ì¸¡íŒ ë‹¨ê°€ ê³ ì • í…Œì´ë¸”
const sidePanelPrices = {
  "ìƒë¶€ì¥-LPM":   { "600": 30000, "ë¹„ê·œê²©": 100000 },
  "ìƒë¶€ì¥-PET":   { "600": 40000, "ë¹„ê·œê²©": 120000 },
  "í•˜ë¶€ì¥-LPM":   { "600": 40000, "ë¹„ê·œê²©": 100000 },
  "í•˜ë¶€ì¥-PET":   { "600": 50000, "ë¹„ê·œê²©": 120000 }
};

let currentMainCategory = "";
let currentSubCategory = "";
let currentCategory = "";
let unitPrices = {};
let allMaterials = [];

window.onload = function () {
  fetch(SCRIPT_URL + "?view=materials")
    .then(res => res.json())
    .then(materials => {
      allMaterials = materials;
      return fetch(SCRIPT_URL);
    })
    .then(res => res.json())
    .then(data => {
      unitPrices = data;
    });

  // âœ… 2ë‹¨ / 3ë‹¨ ì¤‘ í•˜ë‚˜ë§Œ ì„ íƒ
  document.getElementById("twoTier").addEventListener("change", function () {
    if (this.checked) document.getElementById("threeTier").checked = false;
  });
  document.getElementById("threeTier").addEventListener("change", function () {
    if (this.checked) document.getElementById("twoTier").checked = false;
  });

  // âœ… ë³¼ë ˆì¼ / ì–¸ë”ë ˆì¼ ì¤‘ í•˜ë‚˜ë§Œ ì„ íƒ
  document.getElementById("ballRail").addEventListener("change", function () {
    if (this.checked) document.getElementById("underRail").checked = false;
  });
  document.getElementById("underRail").addEventListener("change", function () {
    if (this.checked) document.getElementById("ballRail").checked = false;
  });

 // âœ… ì¶”ê°€: ë°¥ì†¥ì¥ìš© ë³¼/ì–¸ë”ë ˆì¼
  document.getElementById("riceBallRail").addEventListener("change", function () {
    if (this.checked) document.getElementById("riceUnderRail").checked = false;
  });
  document.getElementById("riceUnderRail").addEventListener("change", function () {
    if (this.checked) document.getElementById("riceBallRail").checked = false;
  });

  document.getElementById("imageModal").addEventListener("click", function () {
    this.style.display = "none";
  });
};

    function promptPassword() {
  const input = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (input === "1760") {
    document.getElementById("adminPanel").style.display = "block";
    isAdmin = true;

    document.querySelectorAll(".unit-price-group").forEach(el => {
      el.style.display = "block";
    });

    document.getElementById("currentCategoryText").textContent = currentSubCategory || "-";

    if (currentMainCategory === "ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ") {
      loadArtificialMaterials();  // âœ… ê´€ë¦¬ì ëª¨ë“œ ì¼œì¡Œì„ ë•Œ ëª©ë¡ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    }
  } else if (input !== null) {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  }
}

    function closeAdminPanel() {
  document.getElementById("adminPanel").style.display = "none";
  isAdmin = false;
  document.querySelectorAll(".unit-price-group").forEach(el => {
    el.style.display = "none";
  });

  if (currentMainCategory === "ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ") {
    loadArtificialMaterials();  // âœ… ê´€ë¦¬ìëª¨ë“œ êº¼ì§ˆ ë•Œ ìƒˆë¡œê³ ì¹¨
  }
}

    function selectCategory(main, sub) {
selectedMaterialName = ""; // âœ… ìì¬ëª… ì´ˆê¸°í™”
  const fullCategory = `${main}-${sub}`;
  currentMainCategory = main;
  currentSubCategory = sub;
  currentCategory = fullCategory;

 if (main === "ìƒë¶€ì¥") {
  upperCategory = fullCategory;

  // âœ… ëƒ‰ì¥ê³ ì¥ íŒ¨ë„ ìˆ¨ê¸°ê¸° ì¶”ê°€
  const fridgePanel = document.getElementById("customFridgePanel");
  if (fridgePanel) fridgePanel.style.display = "none";

  // âœ… í‚¤í°ì¥ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  const keyPanel = document.getElementById("customKeyPanel");
  if (keyPanel) keyPanel.style.display = "none";

  // âœ… í›„ë“œ/ìˆ˜ì „ ë…ë¦½ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("customEtcPanel")) {
      panel.style.display = "none";
    }
  });

  // âœ… ìƒë¶€ì¥ íŒ¨ë„ ë³´ì´ê¸°
  document.querySelector('[data-panel="upper"]').style.display = "block";
  document.getElementById("upperFormSection").style.display = "block";

  // âœ… ì¸ì¡°ëŒ€ë¦¬ì„ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  document.getElementById("artificialTopSection").style.display = "none";
  document.getElementById("artificialTopSection").classList.remove("full-width");

  document.getElementById("upperShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${sub}) - ë¯¸ì„ íƒ`;

  if (isAdmin) {
    document.getElementById("upperUnitPriceInput").value = unitPrices[upperCategory] || "";
  }

  // âœ… ìì¬ ë¶ˆëŸ¬ì˜¤ê¸°
  loadPanelMaterials("upper", fullCategory);
}

else if (main === "í•˜ë¶€ì¥") {
  lowerCategory = fullCategory;

  const fridgePanel = document.getElementById("customFridgePanel");
  if (fridgePanel) fridgePanel.style.display = "none";

  const keyPanel = document.getElementById("customKeyPanel");
  if (keyPanel) keyPanel.style.display = "none";

  // âœ… í›„ë“œ/ìˆ˜ì „ íŒ¨ë„ë„ ìˆ¨ê¹€
  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("customEtcPanel")) {
      panel.style.display = "none";
    }
  });

  document.querySelector('[data-panel="lower"]').style.display = "block";
  document.getElementById("lowerFormSection").style.display = "block";

  document.getElementById("artificialTopSection").style.display = "none";
  document.getElementById("artificialTopSection").classList.remove("full-width");

  document.getElementById("lowerShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${sub}) - ë¯¸ì„ íƒ`;

  if (isAdmin) {
    document.getElementById("lowerUnitPriceInput").value = unitPrices[lowerCategory] || "";
  }

  // âœ… ìì¬ ë¶ˆëŸ¬ì˜¤ê¸°
  loadPanelMaterials("lower", fullCategory);
}

else if (main === "ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ") {
  // âœ… í‚¤í°ì¥ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  const keyPanel = document.getElementById("customKeyPanel");
  if (keyPanel) keyPanel.style.display = "none";

  // âœ… ëƒ‰ì¥ê³ ì¥ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  const fridgePanel = document.getElementById("customFridgePanel");
  if (fridgePanel) fridgePanel.style.display = "none";

  // âœ… í›„ë“œ/ìˆ˜ì „ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("customEtcPanel")) {
      panel.style.display = "none";
    }
  });

  // âœ… ìƒë¶€/í•˜ë¶€ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  document.getElementById("upperFormSection").style.display = "none";
  document.getElementById("lowerFormSection").style.display = "none";
  document.querySelector('[data-panel="upper"]').style.display = "none";
  document.querySelector('[data-panel="lower"]').style.display = "none";

  // âœ… ì¸ì¡°ëŒ€ë¦¬ì„ íŒ¨ë„ ë³´ì´ê¸°
  document.getElementById("artificialTopSection").style.display = "flex";
  document.getElementById("artificialTopSection").classList.add("full-width");
  document.getElementById("artificialTopTitle").textContent = `í˜•íƒœ ì„ íƒ (${sub})`;

  // âœ… ë¯¸ë¦¬ë³´ê¸° ë° ë‹¨ê°€ ì´ˆê¸°í™”
  document.getElementById("selectedMaterialPreview").innerHTML = "";
  document.getElementById("artUnitPriceInput").value = "";

  // âœ… ìì¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
  loadArtificialMaterials();

  if (isAdmin) {
    document.getElementById("currentCategoryText").textContent = currentSubCategory || "-";
  }

} else if (main === "ê¸°íƒ€" && sub === "í‚¤í°ì¥") {
  // âœ… ì¸ì¡°ëŒ€ë¦¬ì„ íŒ¨ë„ë„ ìˆ¨ê¹€ (ì´ê²Œ ë¹ ì ¸ ìˆì—ˆìŒ)
  document.getElementById("artificialTopSection").style.display = "none";
  document.getElementById("artificialTopSection").classList.remove("full-width");

  // âœ… ëª¨ë“  ê¸°ì¡´ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  document.querySelector('[data-panel="upper"]').style.display = "none";
  document.querySelector('[data-panel="lower"]').style.display = "none";
  document.getElementById("upperFormSection").style.display = "none";
  document.getElementById("lowerFormSection").style.display = "none";

  // âœ… ê¸°íƒ€ íŒ¨ë„ ìˆ¨ê¹€
  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("custom") && panel.id !== "customKeyPanel") {
      panel.style.display = "none";
    }
  });

  const flexRow = document.querySelector(".flex-row");
  let custom = document.getElementById("customKeyPanel");

  if (!custom) {
    const newPanel = document.createElement("div");
    newPanel.className = "panel";
    newPanel.id = "customKeyPanel";
    newPanel.style.flex = "0 0 32%";

    newPanel.innerHTML = `
  <h3>í‚¤í°ì¥</h3>
  <div class="size-inputs" style="flex-direction: column; align-items: flex-start;">
    <label style="font-size: 16px; font-weight: bold; margin-bottom: 6px;">ê¸¸ì´ ì…ë ¥</label>
    <input type="number" placeholder="ê¸¸ì´ (mm)" id="keyTallLength" />
  </div>

  <hr style="margin: 16px 0; border: none; border-top: 1px solid #ccc;" />

  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
    <label style="font-size: 15px;">ì¸¡íŒ:</label>
    <input type="number" id="keyTallSideCount" placeholder="ê°œìˆ˜" style="width: 80px; padding: 6px;" />
  </div>

  <button class="add-button" onclick="addKeyTallToEstimate()">ê²¬ì ì— ì¶”ê°€</button>
`;
    flexRow.insertBefore(newPanel, document.querySelector(".panel.right"));
  } else {
    custom.style.display = "block";
  }

  // ë‚˜ë¨¸ì§€ í‚¤í°ì¥ ì™¸ì˜ íŒ¨ë„ ìˆ¨ê¹€ (í˜¹ì‹œ ë‹¤ë¥¸ ê¸°íƒ€ íŒ¨ë„ì´ ìƒê¸¸ ê²½ìš° ëŒ€ë¹„)
  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("custom") && panel.id !== "customKeyPanel") {
      panel.style.display = "none";
    }
  });
}

// âœ… ì´ ì•„ë˜ì— ì •í™•í•˜ê²Œ ëƒ‰ì¥ê³ ì¥ ì²˜ë¦¬ ì¶”ê°€
else if (main === "ê¸°íƒ€" && sub === "ëƒ‰ì¥ê³ ì¥") {
  document.getElementById("artificialTopSection").style.display = "none";
  document.getElementById("artificialTopSection").classList.remove("full-width");
  document.querySelector('[data-panel="upper"]').style.display = "none";
  document.querySelector('[data-panel="lower"]').style.display = "none";
  document.getElementById("upperFormSection").style.display = "none";
  document.getElementById("lowerFormSection").style.display = "none";

  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("custom") && panel.id !== "customFridgePanel") {
      panel.style.display = "none";
    }
  });

  const flexRow = document.querySelector(".flex-row");
  let fridgePanel = document.getElementById("customFridgePanel");

  if (!fridgePanel) {
    const newPanel = document.createElement("div");
    newPanel.className = "panel";
    newPanel.id = "customFridgePanel";
    newPanel.style.flex = "0 0 32%";
    newPanel.innerHTML = `
  <h3>ëƒ‰ì¥ê³ ì¥</h3>
  <div class="size-inputs" style="flex-direction: column; align-items: flex-start;">
    <label style="font-size: 16px; font-weight: bold; margin-bottom: 6px;">ê¸¸ì´ ì…ë ¥</label>
    <input type="number" placeholder="ê¸¸ì´ (mm)" id="fridgeLength" />

    <label style="margin-top: 12px; font-size: 16px; font-weight: bold;">ê°œìˆ˜ ì…ë ¥</label>
    <input type="number" placeholder="ê°œìˆ˜" id="fridgeCount" />

    <label style="margin-top: 12px; font-size: 16px; font-weight: bold;">ì¸¡íŒ ê°œìˆ˜</label>
    <input type="number" placeholder="ì¸¡íŒ ê°œìˆ˜" id="fridgeSideCount" />
  </div>

  <button class="add-button" onclick="addFridgeToEstimate()" style="margin-top: 16px;">ê²¬ì ì— ì¶”ê°€</button>
`;
    flexRow.insertBefore(newPanel, document.querySelector(".panel.right"));
  } else {
    fridgePanel.style.display = "block";
  }
}

// âœ… ì—¬ê¸°ì— í›„ë“œ/900í›„ë“œ/ì‹±í¬ë³¼/ì‹±í¬ìˆ˜ì „ ì²˜ë¦¬ ì¶”ê°€
else if (["í›„ë“œ", "900í›„ë“œ", "ì‹±í¬ë³¼", "ì‹±í¬ìˆ˜ì „", "ì¿¡íƒ‘", "ì½˜ì„¼íŠ¸"].includes(sub)) {
  // ê¸°ì¡´ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  document.getElementById("artificialTopSection").style.display = "none";
  document.getElementById("artificialTopSection").classList.remove("full-width");
  document.querySelector('[data-panel="upper"]').style.display = "none";
  document.querySelector('[data-panel="lower"]').style.display = "none";
  document.getElementById("upperFormSection").style.display = "none";
  document.getElementById("lowerFormSection").style.display = "none";

  // âœ… ì—¬ê¸°ì— ì¶”ê°€: í‚¤í°ì¥/ëƒ‰ì¥ê³ ì¥ íŒ¨ë„ ìˆ¨ê¸°ê¸°
  const keyPanel = document.getElementById("customKeyPanel");
  if (keyPanel) keyPanel.style.display = "none";

  const fridgePanel = document.getElementById("customFridgePanel");
  if (fridgePanel) fridgePanel.style.display = "none";

  // ì´í›„ ê¸°ì¡´ ê¸°íƒ€ íŒ¨ë„ ìˆ¨ê¸°ê¸° (ì´ ì½”ë“œëŠ” ê¸°ì¡´ëŒ€ë¡œ ìœ ì§€)
  document.querySelectorAll(".flex-row > .panel").forEach(panel => {
    if (panel.id.startsWith("customEtcPanel") && panel.id !== `customEtcPanel-${sub}`) {
      panel.style.display = "none";
    }
  });

  const flexRow = document.querySelector(".flex-row");
  let etcPanel = document.getElementById(`customEtcPanel-${sub}`);

  if (!etcPanel) {
  const newPanel = document.createElement("div");
  newPanel.className = "panel";
  newPanel.id = `customEtcPanel-${sub}`;
  newPanel.style.flex = "1"; // âœ… ì—¬ê¸°ê°€ í•µì‹¬
  newPanel.innerHTML = `
  <h3>ìì¬ ëª©ë¡ (${sub})</h3>
  <div id="etcMaterialList-${sub}"></div>
`;
  flexRow.insertBefore(newPanel, document.querySelector(".panel.right"));
} else {
  etcPanel.innerHTML = `
  <h3>ìì¬ ëª©ë¡ (${sub})</h3>
  <div id="etcMaterialList-${sub}"></div>
`;
  etcPanel.style.display = "block";
  etcPanel.style.flex = "1"; // âœ… ì¬ì‚¬ìš© ì‹œë„ ë°˜ì˜
}
// âœ… ì´ ì•„ë˜ì— ìì¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ í˜¸ì¶œ ì¶”ê°€!
  loadEtcMaterials(fullCategory, `etcMaterialList-${sub}`);
}
if (isAdmin) {
  document.getElementById("currentCategoryText").textContent = currentSubCategory || "-";
}
}

    function updateSizeInputs(part, count) {
  // ê¸°ì¡´ ì‚¬ì´ì¦ˆ ì…ë ¥ ì„¹ì…˜ ëª¨ë‘ ìˆ¨ê¹€
  document.getElementById(part + "SizeSection").style.display = "none";

  // ìƒˆë¡œ ì„ íƒí•œ ì‚¬ì´ì¦ˆ ì…ë ¥ ì„¹ì…˜ í‘œì‹œ
  const container = document.getElementById(part + "SizeInputs");
  container.innerHTML = "";

  for (let i = 1; i <= count; i++) {
    const input = document.createElement("input");
    input.type = "number";
    input.placeholder = `ê¸¸ì´ ${i} (mm)`;
    container.appendChild(input);
  }

  // í•´ë‹¹ ì„¹ì…˜ ë³´ì´ê²Œ ì„¤ì •
  document.getElementById(part + "SizeSection").style.display = "block";
}

    function saveUnitPrice(part) {
  let category = "";
if (part === "upper") category = upperCategory;
else if (part === "lower") category = lowerCategory;
else if (part === "art") category = currentCategory;
  const input = document.getElementById(part + "UnitPriceInput");
  const unitPrice = parseFloat(input.value);

  if (!category || isNaN(unitPrice)) {
    alert("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      type: "unitPrice",
      category,
      price: unitPrice
    })
  })
  .then(res => res.text())
  .then(() => {
    alert("ë‹¨ê°€ ì €ì¥ ì™„ë£Œ");
    unitPrices[category] = unitPrice;
  });
}

    function addToEstimate(part) {
  let category = "";
  if (part === "upper") category = upperCategory;
  else if (part === "lower") category = lowerCategory;
  else if (part === "art") category = currentCategory;

  const inputs = document.querySelectorAll(`#${part}SizeInputs input`);
  let totalLengthMM = 0;

  const selectedShape = document.querySelector(`input[name="${part}Shape"]:checked`);
  const shapeLabel = selectedShape 
    ? selectedShape.parentElement.textContent.trim() 
    : "";

  inputs.forEach(input => {
    const val = parseFloat(input.value);
    if (!isNaN(val)) totalLengthMM += val;
  });

  const totalLengthM = totalLengthMM / 1000;

  let unitPrice = parseFloat(document.getElementById(part + "UnitPriceInput").value);
  if (isNaN(unitPrice) || unitPrice === 0) {
    unitPrice = unitPrices[category] || 0;
  }

  const totalCost = Math.round(totalLengthM * unitPrice);
  const nameToShow = selectedMaterialName || "ë¯¸ì„ íƒ";

  let text = `${shapeLabel} ${category} ${nameToShow} / ì´ê¸¸ì´ ${totalLengthMM}mm = <strong>${totalCost.toLocaleString()}ì›</strong>`;

// âœ… ì¸ì¡°ëŒ€ë¦¬ì„ì—ëŠ” ì¸¡íŒ ì—†ìŒ â†’ upper/lowerì¼ ë•Œë§Œ ì²˜ë¦¬
if (part === "upper" || part === "lower") {
  const side600Qty = parseFloat(document.getElementById(part + "Side600Input").value);
  const sideCustomQty = parseFloat(document.getElementById(part + "SideCustomInput").value);
  const baseCat = (part === "upper") ? upperCategory : lowerCategory;

  if (!isNaN(side600Qty) && side600Qty > 0) {
    const unit = sidePanelPrices[baseCat]?.["600"] || 0;
    const cost = unit * side600Qty;
    text += `<br>600ì¸¡íŒ ${side600Qty}ê°œ = <strong>${cost.toLocaleString()}ì›</strong>`;
  }

  if (!isNaN(sideCustomQty) && sideCustomQty > 0) {
    const unit = sidePanelPrices[baseCat]?.["ë¹„ê·œê²©"] || 0;
    const cost = unit * sideCustomQty;
    text += `<br>ë¹„ê·œê²©ì¸¡íŒ ${sideCustomQty}ê°œ = <strong>${cost.toLocaleString()}ì›</strong>`;
  }
}

  // âœ… í•˜ë¶€ì¥ ì„œëì¥/ë°¥ì†¥ì¥ ì¶”ê°€
  if (part === "lower") {
    const drawerVal = parseFloat(document.getElementById("drawerInput").value);
    if (!isNaN(drawerVal) && drawerVal > 0) {
      const drawerM = drawerVal / 1000;
      let drawerCost = Math.round(drawerM * 150000 * 1.3);

      const isBall = document.getElementById("ballRail").checked;
      const isUnder = document.getElementById("underRail").checked;
      const isTwoTier = document.getElementById("twoTier").checked;
      const isThreeTier = document.getElementById("threeTier").checked;

      if (isUnder) {
        if (isTwoTier) drawerCost += 40000;
        if (isThreeTier) drawerCost += 60000;
      }

      let railText = "";
      if (isTwoTier) railText += " (2ë‹¨)";
      if (isThreeTier) railText += " (3ë‹¨)";
      if (isBall) railText += " (ë³¼ë ˆì¼)";
      if (isUnder) railText += " (ì–¸ë”ë ˆì¼)";

      text += `<br>ì„œëì¥ ${drawerVal}mm${railText} = <strong>${drawerCost.toLocaleString()}ì›</strong>`;
    }

    const riceVal = parseFloat(document.getElementById("riceBoxInput").value);
    if (!isNaN(riceVal) && riceVal > 0) {
      const riceM = riceVal / 1000;
      let riceCost = Math.round(riceM * 150000 * 1.5);

      const isRiceUnder = document.getElementById("riceUnderRail").checked;
      if (isRiceUnder) riceCost += 20000;

      let riceRailText = "";
      if (document.getElementById("riceBallRail").checked) riceRailText = " (ë³¼ë ˆì¼)";
      if (isRiceUnder) riceRailText = " (ì–¸ë”ë ˆì¼)";

      text += `<br>í•˜ë¶€ì¥ ë°¥ì†¥ì¥ ${riceVal}mm${riceRailText} = <strong>${riceCost.toLocaleString()}ì›</strong>`;
    }
  }

  if (part === "upper") {
    const lightingChecked = document.getElementById("upperLightingCheckbox").checked;
    if (lightingChecked) {
      text += `<br>ìƒë¶€ì¥ ê°„ì ‘ì¡°ëª… = <strong>150,000ì›</strong>`;
    }
  }

let list;

if (part === "upper") {
  if (part === "upper") {
  let sectionId = "estimate-upper";
  let section = document.getElementById(sectionId);

  if (!section) {
    section = document.createElement("div");
    section.id = sectionId;
    section.innerHTML = `
      <h4>ìƒë¶€ì¥</h4>
      <div class="estimate-category-list"></div>
      <hr>
    `;
    insertSectionInOrder(section);
  }

  list = section.querySelector(".estimate-category-list");
}
} else if (part === "lower") {
  list = getOrCreateLowerSection();
} else if (part === "art") {
  list = getOrCreateArtSection();
} else if (currentMainCategory === "ê¸°íƒ€" && currentSubCategory === "í‚¤í°ì¥") {
  list = document.querySelector("#estimate-key .estimate-category-list");
} else if (currentMainCategory === "ê¸°íƒ€" && currentSubCategory === "ëƒ‰ì¥ê³ ì¥") {
  list = document.querySelector("#estimate-fridge .estimate-category-list");
} else {
  list = document.getElementById("estimateList");  // í˜¹ì‹œ ì˜ˆì™¸ ëŒ€ë¹„í•´ì„œ ì„ì‹œ ë³´ê´€
}

const item = document.createElement("div");
const lines = text.split('<br>');
item.innerHTML = lines.map(line => `
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <span>${line}</span>
    <button onclick="this.parentElement.remove(); updateTotalCost()"
      style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">
      X
    </button>
  </div>
`).join('');
list.appendChild(item);

  updateTotalCost(); // âœ… ì´ì•¡ ê°±ì‹ 

  // âœ… ì…ë ¥ê°’ ì´ˆê¸°í™” ì¶”ê°€
  if (part === "upper") {
    document.querySelectorAll("#upperSizeInputs input").forEach(input => input.value = "");
    document.getElementById("upperSide600Input").value = "";
    document.getElementById("upperSideCustomInput").value = "";
    document.getElementById("upperLightingCheckbox").checked = false;
  } else if (part === "lower") {
    document.querySelectorAll("#lowerSizeInputs input").forEach(input => input.value = "");
    document.getElementById("lowerSide600Input").value = "";
    document.getElementById("lowerSideCustomInput").value = "";
    document.getElementById("drawerInput").value = "";
    document.getElementById("riceBoxInput").value = "";
    ["twoTier", "threeTier", "ballRail", "underRail", "riceBallRail", "riceUnderRail"].forEach(id => {
      document.getElementById(id).checked = false;
    });
  } else if (part === "art") {
    document.querySelectorAll("#artSizeInputs input").forEach(input => input.value = "");
    document.getElementById("artUnitPriceInput").value = "";
    document.getElementById("selectedMaterialPreview").innerHTML = "";
  }

  // âœ… ìì¬ëª… í‘œì‹œ ì—…ë°ì´íŠ¸
  if (part === "upper") {
    document.getElementById("upperShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${currentSubCategory}) - ${selectedMaterialName}`;
  } else if (part === "lower") {
    document.getElementById("lowerShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${currentSubCategory}) - ${selectedMaterialName}`;
  } else if (part === "art") {
    document.getElementById("artificialShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${currentSubCategory}) - ${selectedMaterialName}`;
  }
}

function addKeyTallToEstimate() {
  const length = parseFloat(document.getElementById("keyTallLength").value);
  const sideCount = parseFloat(document.getElementById("keyTallSideCount").value);

  if (isNaN(length) || length <= 0) {
    alert("ê¸¸ì´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const unit = 300;
  const unitPrice = 125000;
  const sideUnitPrice = 80000;

  const roundedLength = Math.ceil(length / unit) * unit;
  const unitCount = roundedLength / unit;
  const mainCost = unitCount * unitPrice;

  const sideCost = (!isNaN(sideCount) && sideCount > 0) ? sideCount * sideUnitPrice : 0;
  const totalCost = mainCost + sideCost;

  const list = document.getElementById("estimateList");
  const item = document.createElement("div");
 item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>í‚¤í°ì¥ ${length}mm = <strong>${totalCost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()"
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">
        X
      </button>
    </div>`;
  list.appendChild(item);
  updateTotalCost(); // âœ… ì´ì•¡ ê°±ì‹ 
}

function clearEstimate() {
  document.getElementById("estimateList").innerHTML = "";
  updateTotalCost(); // âœ… ì´ì•¡ ì´ˆê¸°í™”
}
function loadArtificialMaterials() {
  const filtered = allMaterials.filter(item => item.category === currentCategory);
  // âœ… BEST ë¨¼ì € ì˜¤ë„ë¡ ì •ë ¬
  filtered.sort((a, b) => {
    const aBest = a.best === "Y" || a.best === true;
    const bBest = b.best === "Y" || b.best === true;
    return (bBest ? 1 : 0) - (aBest ? 1 : 0);
  });

  const container = document.getElementById("artificialMaterialList");
  container.innerHTML = "";

  filtered.forEach((item, index) => {
  const card = document.createElement("div");
  card.className = "material-card";

  const bestLabel = item.best ? '<div class="best-label">BEST</div>' : '';
  const basicLabel = item.basic ? '<div class="basic-label">ê¸°ë³¸í˜•</div>' : '';

let priceHTML = "";
if (isAdmin) {
  priceHTML += `
    <div>
      <span id="priceText-${index}">${parseInt(item.price).toLocaleString()}ì›</span>
      <button onclick="toggleEditPrice('art', ${index})" style="margin-left:4px; border:none; background:none; cursor:pointer;">âœ</button>
    </div>
  `;
}

const editBox = `
  <div class="price-edit-box" id="editBox-art-${index}" style="display:none; margin-top:6px;">
    <input type="number" id="editInput-art-${index}" style="width:80px;" />
    <button onclick="saveEditedPrice('art', ${index})">ì €ì¥</button>
  </div>
`;

  card.innerHTML = `
    ${bestLabel}
    ${basicLabel}
    <img src="${item.img1}" alt="${item.name}" onclick="showImageModal('${item.img1}')" style="cursor: zoom-in;" />
    <div><strong>${item.name}</strong></div>
    ${priceHTML}
    ${editBox}
    <button onclick="setUnitPriceFromMaterial(${item.price}, \`${item.name}\`, \`${item.img1}\`, 'art')">ì¶”ê°€</button>
${isAdmin ? `<button onclick="toggleBestLabel(\`${item.category}\`, \`${item.name}\`)">â­ BEST ì¶”ê°€</button>` : ''}
${isAdmin ? `<button onclick="toggleBasicLabel(\`${item.category}\`, \`${item.name}\`)">ğŸ“Œ ê¸°ë³¸í˜• ì¶”ê°€</button>` : ''}
  `;

  container.appendChild(card);
});
}

function loadEtcMaterials(category, containerId) {
  const filtered = allMaterials.filter(item => item.category === category);

  filtered.sort((a, b) => {
    let prefixA = a.name.includes("(") ? a.name.split("(")[0].trim() : "";
    let prefixB = b.name.includes("(") ? b.name.split("(")[0].trim() : "";

    if (prefixA < prefixB) return -1;
    if (prefixA > prefixB) return 1;

    const aBest = a.best === "Y" || a.best === true;
    const bBest = b.best === "Y" || b.best === true;
    return (bBest ? 1 : 0) - (aBest ? 1 : 0);
  });

  const container = document.getElementById(containerId);
  container.innerHTML = "";

  let currentSection = "";

filtered.forEach((item, index) => {
  // âœ… ì´ë¦„ì—ì„œ prefix ì¶”ì¶œ
  let prefix = "ê¸°íƒ€";
  if (item.name.includes("(")) {
    prefix = item.name.split("(")[0].trim();
  }

  // âœ… êµ¬ë¶„ì„  + ìƒˆë¡œìš´ grid ë§Œë“¤ì–´ì£¼ê¸°
  if (currentSection !== prefix) {
    const divider = document.createElement("div");
    divider.innerHTML = `<h4 style="margin: 16px 0;">${prefix}</h4>`;
    container.appendChild(divider);

    const grid = document.createElement("div");
    grid.className = "material-grid";
    grid.id = `grid-${prefix}`;
    container.appendChild(grid);

    currentSection = prefix;
  }

    // âœ… ìì¬ ì¹´ë“œ ìƒì„± (ê¸°ì¡´ ì¹´ë“œ ìƒì„± ë¡œì§ ìœ ì§€)
    const card = document.createElement("div");
    card.className = "material-card";

    const bestLabel = item.best ? '<div class="best-label">BEST</div>' : '';
    const basicLabel = item.basic ? '<div class="basic-label">ê¸°ë³¸í˜•</div>' : '';

    let priceHTML = `
      <div>
        <span id="priceText-etc-${index}">${parseInt(item.price).toLocaleString()}ì›</span>
    `;

    if (isAdmin) {
      priceHTML += `
        <button onclick="toggleEditPrice('etc', ${index})" style="margin-left:4px; border:none; background:none; cursor:pointer;">âœ</button>
      `;
    }

    priceHTML += `</div>`;

    const editBox = `
      <div class="price-edit-box" id="editBox-etc-${index}" style="display:none; margin-top:6px;">
        <input type="number" id="editInput-etc-${index}" style="width:80px;" />
        <button onclick="saveEditedPrice('etc', ${index})">ì €ì¥</button>
      </div>
    `;

    card.innerHTML = `
    ${bestLabel}
    ${basicLabel}
      <img src="${item.img1}" alt="${item.name}" onclick="showImageModal('${item.img1}')" style="cursor: zoom-in;" />
      <div><strong>${item.name}</strong></div>
      ${priceHTML}
      ${editBox}
      <button onclick="addCustomEtcToEstimate(\`${item.name}\`)">ì¶”ê°€</button>
${isAdmin ? `<button onclick="toggleBestLabel(\`${item.category}\`, \`${item.name}\`)">â­ BEST ì¶”ê°€</button>` : ''}
${isAdmin ? `<button onclick="toggleBasicLabel(\`${item.category}\`, \`${item.name}\`)">ğŸ“Œ ê¸°ë³¸í˜• ì¶”ê°€</button>` : ''}
    `;

    document.getElementById(`grid-${prefix}`).appendChild(card);
});
}

function loadPanelMaterials(part, category) {
  const targetId = part === "upper" ? "upperMaterialList" : "lowerMaterialList";
  const container = document.getElementById(targetId);
  container.innerHTML = "";

  const filtered = allMaterials.filter(item => item.category === category);

// âœ… BEST ìš°ì„  ì •ë ¬
filtered.sort((a, b) => {
  const aBest = a.best === "Y" || a.best === true;
  const bBest = b.best === "Y" || b.best === true;
  return (bBest ? 1 : 0) - (aBest ? 1 : 0);
});

  filtered.forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "material-card";

  const bestLabel = item.best ? '<div class="best-label">BEST</div>' : '';
  const basicLabel = item.basic ? '<div class="basic-label">ê¸°ë³¸í˜•</div>' : '';

    let priceHTML = "";
    if (isAdmin) {
      priceHTML += `
        <div>
          <span id="priceText-${part}-${index}">${parseInt(item.price).toLocaleString()}ì›</span>
          <button onclick="toggleEditPrice('${part}', ${index})" style="margin-left:4px; border:none; background:none; cursor:pointer;">âœ</button>
        </div>
      `;
    }

    const editBox = `
      <div class="price-edit-box" id="editBox-${part}-${index}" style="display:none; margin-top:6px;">
        <input type="number" id="editInput-${part}-${index}" style="width:80px;" />
        <button onclick="saveEditedPrice('${part}', ${index})">ì €ì¥</button>
      </div>
    `;

    card.innerHTML = `
    ${bestLabel}
    ${basicLabel}
      <img src="${item.img1}" alt="${item.name}" onclick="showImageModal('${item.img1}')" style="cursor: zoom-in;" />
      <div><strong>${item.name}</strong></div>
      ${priceHTML}
      ${editBox}
      <button onclick="setUnitPriceFromMaterial(${item.price}, \`${item.name}\`, \`${item.img1}\`, '${part}')">ì¶”ê°€</button>
${isAdmin ? `<button onclick="toggleBestLabel(\`${item.category}\`, \`${item.name}\`)">â­ BEST ì¶”ê°€</button>` : ''}
${isAdmin ? `<button onclick="toggleBasicLabel(\`${item.category}\`, \`${item.name}\`)">ğŸ“Œ ê¸°ë³¸í˜• ì¶”ê°€</button>` : ''}
    `;

    container.appendChild(card);
  });
}

function editMaterialPrice(index) {
  const newPrice = prompt("ìƒˆ ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”:");
  if (!newPrice || isNaN(newPrice)) {
    alert("ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const price = parseInt(newPrice);
  const item = allMaterials.filter(item => item.category === currentCategory)[index];
  item.price = price;

  // ì„œë²„ì—ë„ ì—…ë°ì´íŠ¸
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      type: "updateMaterialPrice",
      category: item.category,
      name: item.name,
      price: price
    })
  })
  .then(res => res.text())
  .then(msg => {
    alert("ê°€ê²© ìˆ˜ì • ì™„ë£Œ");
    loadArtificialMaterials(); // ë‹¤ì‹œ ë Œë”ë§
  });
}
function uploadMaterial() {
  const category = currentCategory;
  const name = document.querySelector('#adminPanel input[type="text"]').value;
  const price = document.querySelector('#adminPanel input[type="number"]').value;
  const img1 = document.querySelectorAll('#adminPanel input[type="file"]')[0].files[0];
  const img2 = document.querySelectorAll('#adminPanel input[type="file"]')[1].files[0];

  if (!category || !name || !price || !img1) {
    alert("ì¹´í…Œê³ ë¦¬, ìì¬ ì´ë¦„, ê°€ê²©, ì´ë¯¸ì§€1ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    return;
  }

  const reader1 = new FileReader();
  const reader2 = new FileReader();

  reader1.onload = function (e1) {
    if (img2) {
      reader2.onload = function (e2) {
        sendMaterialData(e1.target.result, e2.target.result);
      };
      reader2.readAsDataURL(img2);
    } else {
      // ì´ë¯¸ì§€2ê°€ ì—†ìœ¼ë©´ ì´ë¯¸ì§€1ìœ¼ë¡œ ëŒ€ì²´
      sendMaterialData(e1.target.result, e1.target.result);
    }
  };
  reader1.readAsDataURL(img1);

  function sendMaterialData(image1, image2) {
    const body = {
      type: "material",
      category,
      name,
      price,
      img1: image1,
      img2: image2,
      best: false,
      basic: false
    };

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(body)
    })
      .then(res => res.text())
      .then(msg => {
        alert(msg);
        if (category.startsWith("ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ")) loadArtificialMaterials();
      });
  }
}

function setUnitPriceFromMaterial(price, name, img, part) {
  selectedMaterialName = name; // âœ… ìì¬ëª… ì €ì¥

  if (part === "art") {
    document.getElementById("artUnitPriceInput").value = price;
    const preview = document.getElementById("selectedMaterialPreview");
    preview.innerHTML = `
      <div class="material-preview-box">
        <img src="${img}" alt="${name}" />
        <strong>${name}</strong>
      </div>
    `;
    document.getElementById("artificialShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${currentSubCategory}) - ${name}`;
  } else if (part === "upper") {
    document.getElementById("upperUnitPriceInput").value = price;
    document.getElementById("upperShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${currentSubCategory}) - ${name}`;
  } else if (part === "lower") {
    document.getElementById("lowerUnitPriceInput").value = price;
    document.getElementById("lowerShapeTitle").textContent = `í˜•íƒœ ì„ íƒ (${currentSubCategory}) - ${name}`;
  }
}

function saveEditedPrice(part, index) {
  const input = document.getElementById(`editInput-${part}-${index}`);
  const newPrice = parseInt(input.value);
  if (isNaN(newPrice)) {
    alert("ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const filtered = allMaterials.filter(i => i.category === currentCategory);
  const item = filtered[index];
  item.price = newPrice;

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      type: "updateMaterialPrice",
      category: item.category,
      name: item.name,
      price: newPrice
    })
  })
  .then(res => res.text())
  .then(() => {
    if (part === "art") {
      loadArtificialMaterials();  // âœ… ì¸ì¡°ëŒ€ë¦¬ì„ì€ ì´ê±¸ë¡œ ë‹¤ì‹œ ë Œë”ë§
    } else {
      loadPanelMaterials(part, item.category);
    }
  });
}
function showImageModal(src) {
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImage");
  modalImg.src = src;
  modal.style.display = "flex";
}

function closeImageModal() {
  document.getElementById("imageModal").style.display = "none";
}

function toggleEditPrice(part, index) {
  const box = document.getElementById(`editBox-${part}-${index}`);
  const input = document.getElementById(`editInput-${part}-${index}`);

  if (!box || !input) return; // ğŸ” ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨

  if (box.style.display === "none") {
    box.style.display = "flex";
    input.value = "";
  } else {
    box.style.display = "none";
  }
}

function getOrCreateUpperSection() {
  let sectionId = "estimate-upper";
  let section = document.getElementById(sectionId);

  if (!section) {
    section = document.createElement("div");
    section.id = sectionId;
    section.innerHTML = `
      <h4>ìƒë¶€ì¥</h4>
      <div class="estimate-category-list"></div>
      <hr>
    `;
    document.getElementById("estimateList").appendChild(section);
  }

  return section.querySelector(".estimate-category-list");
}

function updateTotalCost() {
  const estimateItems = document.querySelectorAll("#estimateList strong");
  let total = 0;

  estimateItems.forEach(el => {
    const num = parseInt(el.textContent.replace(/[^\d]/g, ""));
    if (!isNaN(num)) total += num;
  });

  document.getElementById("totalCost").textContent = total.toLocaleString();
}

function summarizeEstimate() {
  const items = document.querySelectorAll("#estimateList span");
  const nameCount = {};

  items.forEach(span => {
    let name = span.textContent.split("=")[0].trim();
    if (nameCount[name]) {
      nameCount[name]++;
    } else {
      nameCount[name] = 1;
    }
  });

  let result = "";
  for (const name in nameCount) {
    if (nameCount[name] === 1) {
      result += `${name}\n`;
    } else {
      result += `${name} ${nameCount[name]}EA\n`;
    }
  }

  document.getElementById("summaryBox").textContent = result.trim();
}

function getOrCreateLowerSection() {
  let sectionId = "estimate-lower";
  let section = document.getElementById(sectionId);

  if (!section) {
    section = document.createElement("div");
    section.id = sectionId;
    section.innerHTML = `
      <h4>í•˜ë¶€ì¥</h4>
      <div class="estimate-category-list"></div>
      <hr>
    `;
    insertSectionInOrder(section);
  }

  return section.querySelector(".estimate-category-list");
}

function getOrCreateArtSection() {
  let sectionId = "estimate-artificial";
  let section = document.getElementById(sectionId);

  if (!section) {
    section = document.createElement("div");
    section.id = sectionId;
    section.innerHTML = `
      <h4>ì¸ì¡°ëŒ€ë¦¬ì„ ìƒíŒ</h4>
      <div class="estimate-category-list"></div>
      <hr>
    `;
    insertSectionInOrder(section);
  }

  return section.querySelector(".estimate-category-list");
}

function addLowerSizeOnly() {
  const inputs = document.querySelectorAll("#lowerSizeInputs input");
  let totalMM = 0;
  inputs.forEach(input => {
    const val = parseFloat(input.value);
    if (!isNaN(val)) totalMM += val;
  });

  if (totalMM === 0) return alert("ê¸¸ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

  const totalM = totalMM / 1000;
  const unitPrice = parseFloat(document.getElementById("lowerUnitPriceInput").value) || unitPrices[lowerCategory] || 0;
  const totalCost = Math.round(totalM * unitPrice);

  const selectedShape = document.querySelector(`input[name="lowerShape"]:checked`);
  const shapeLabel = selectedShape ? selectedShape.parentElement.textContent.trim() : "í˜•íƒœ ë¯¸ì„ íƒ";

  const nameToShow = selectedMaterialName || "ë¯¸ì„ íƒ";

  const item = document.createElement("div");
  item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>${shapeLabel} ${lowerCategory} ${nameToShow} / ì´ê¸¸ì´ ${totalMM}mm = <strong>${totalCost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>`;

  const list = getOrCreateLowerSection();
  list.appendChild(item);
  updateTotalCost();

  document.querySelectorAll("#lowerSizeInputs input").forEach(input => input.value = "");
}

function addLowerSidePanelsOnly() {
  const qty600 = parseFloat(document.getElementById("lowerSide600Input").value);
  const qtyCustom = parseFloat(document.getElementById("lowerSideCustomInput").value);
  const baseCat = lowerCategory;

  let text = "";

  if (!isNaN(qty600) && qty600 > 0) {
    const unit = sidePanelPrices[baseCat]?.["600"] || 0;
    const cost = unit * qty600;
    text += `600ì¸¡íŒ ${qty600}ê°œ = <strong>${cost.toLocaleString()}ì›</strong>`;
  }

  if (!isNaN(qtyCustom) && qtyCustom > 0) {
    const unit = sidePanelPrices[baseCat]?.["ë¹„ê·œê²©"] || 0;
    const cost = unit * qtyCustom;
    if (text !== "") text += "<br>";
    text += `ë¹„ê·œê²©ì¸¡íŒ ${qtyCustom}ê°œ = <strong>${cost.toLocaleString()}ì›</strong>`;
  }

  if (text === "") {
    alert("600ì¸¡íŒ ë˜ëŠ” ë¹„ê·œê²©ì¸¡íŒ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const item = document.createElement("div");
  item.innerHTML = text.split('<br>').map(line => `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>${line}</span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>
  `).join('');

  const list = getOrCreateLowerSection();
  list.appendChild(item);
  updateTotalCost();

  document.getElementById("lowerSide600Input").value = "";
  document.getElementById("lowerSideCustomInput").value = "";
}

function addLowerDrawerOnly() {
  const drawerVal = parseFloat(document.getElementById("drawerInput").value);
  if (isNaN(drawerVal) || drawerVal <= 0) return alert("ì„œëì¥ ê¸¸ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

  const drawerM = drawerVal / 1000;
  let drawerCost = Math.round(drawerM * 150000 * 1.3);

  const isBall = document.getElementById("ballRail").checked;
  const isUnder = document.getElementById("underRail").checked;
  const isTwoTier = document.getElementById("twoTier").checked;
  const isThreeTier = document.getElementById("threeTier").checked;

  if (isUnder) {
    if (isTwoTier) drawerCost += 40000;
    if (isThreeTier) drawerCost += 60000;
  }

  let railText = "";
  if (isTwoTier) railText += " (2ë‹¨)";
  if (isThreeTier) railText += " (3ë‹¨)";
  if (isBall) railText += " (ë³¼ë ˆì¼)";
  if (isUnder) railText += " (ì–¸ë”ë ˆì¼)";

  const item = document.createElement("div");
  item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>ì„œëì¥ ${drawerVal}mm${railText} = <strong>${drawerCost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>`;

  const list = getOrCreateLowerSection();
  list.appendChild(item);
  updateTotalCost();

  document.getElementById("drawerInput").value = "";
  ["twoTier", "threeTier", "ballRail", "underRail"].forEach(id => {
    document.getElementById(id).checked = false;
  });
}

function addLowerRiceBoxOnly() {
  const riceVal = parseFloat(document.getElementById("riceBoxInput").value);
  if (isNaN(riceVal) || riceVal <= 0) return alert("ë°¥ì†¥ì¥ ê¸¸ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

  const riceM = riceVal / 1000;
  let riceCost = Math.round(riceM * 150000 * 1.5);

  const isRiceUnder = document.getElementById("riceUnderRail").checked;
  if (isRiceUnder) riceCost += 20000;

  let riceRailText = "";
  if (document.getElementById("riceBallRail").checked) riceRailText = " (ë³¼ë ˆì¼)";
  if (isRiceUnder) riceRailText = " (ì–¸ë”ë ˆì¼)";

  const item = document.createElement("div");
  item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>í•˜ë¶€ì¥ ë°¥ì†¥ì¥ ${riceVal}mm${riceRailText} = <strong>${riceCost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>`;

  const list = getOrCreateLowerSection();
  list.appendChild(item);
  updateTotalCost();

  document.getElementById("riceBoxInput").value = "";
  ["riceBallRail", "riceUnderRail"].forEach(id => {
    document.getElementById(id).checked = false;
  });
}

function addUpperSizeOnly() {
  const inputs = document.querySelectorAll("#upperSizeInputs input");
  let totalMM = 0;
  inputs.forEach(input => {
    const val = parseFloat(input.value);
    if (!isNaN(val)) totalMM += val;
  });

  if (totalMM === 0) return alert("ê¸¸ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

  const totalM = totalMM / 1000;
  const unitPrice = parseFloat(document.getElementById("upperUnitPriceInput").value) || unitPrices[upperCategory] || 0;
  const totalCost = Math.round(totalM * unitPrice);

  const selectedShape = document.querySelector(`input[name="upperShape"]:checked`);
  const shapeLabel = selectedShape ? selectedShape.parentElement.textContent.trim() : "í˜•íƒœ ë¯¸ì„ íƒ";

  const nameToShow = selectedMaterialName || "ë¯¸ì„ íƒ";

  const item = document.createElement("div");
  item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>${shapeLabel} ${upperCategory} ${nameToShow} / ì´ê¸¸ì´ ${totalMM}mm = <strong>${totalCost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>`;

  const list = getOrCreateUpperSection();
  list.appendChild(item);
  updateTotalCost();
  document.querySelectorAll("#upperSizeInputs input").forEach(input => input.value = "");
}

function addUpperSideCustomOnly() {
  const qty600 = parseFloat(document.getElementById("upperSide600Input").value);
  const qtyCustom = parseFloat(document.getElementById("upperSideCustomInput").value);
  const baseCat = upperCategory;

  let text = "";

  if (!isNaN(qty600) && qty600 > 0) {
    const unit = sidePanelPrices[baseCat]?.["600"] || 0;
    const cost = unit * qty600;
    text += `600ì¸¡íŒ ${qty600}ê°œ = <strong>${cost.toLocaleString()}ì›</strong>`;
  }

  if (!isNaN(qtyCustom) && qtyCustom > 0) {
    const unit = sidePanelPrices[baseCat]?.["ë¹„ê·œê²©"] || 0;
    const cost = unit * qtyCustom;
    if (text !== "") text += "<br>";
    text += `ë¹„ê·œê²©ì¸¡íŒ ${qtyCustom}ê°œ = <strong>${cost.toLocaleString()}ì›</strong>`;
  }

  if (text === "") {
    alert("600ì¸¡íŒ ë˜ëŠ” ë¹„ê·œê²©ì¸¡íŒ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const item = document.createElement("div");
  item.innerHTML = text.split('<br>').map(line => `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>${line}</span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>
  `).join('');

  const list = getOrCreateUpperSection();
  list.appendChild(item);
  updateTotalCost();

  document.getElementById("upperSide600Input").value = "";
  document.getElementById("upperSideCustomInput").value = "";
}

function addUpperLightingOnly() {
  const checked = document.getElementById("upperLightingCheckbox").checked;
  if (!checked) return alert("ì²´í¬ë°•ìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");

  const cost = 150000;
  const item = document.createElement("div");
  item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>ìƒë¶€ì¥ ê°„ì ‘ì¡°ëª… = <strong>${cost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>`;

  const list = getOrCreateUpperSection();
  list.appendChild(item);
  updateTotalCost();

  document.getElementById("upperLightingCheckbox").checked = false;
}

function addFridgeToEstimate() {
  const length = parseFloat(document.getElementById("fridgeLength").value);
  const count = parseFloat(document.getElementById("fridgeCount").value);
  const sideCount = parseFloat(document.getElementById("fridgeSideCount").value);

  if (isNaN(length) || length <= 0 || isNaN(count) || count <= 0) {
    alert("ê¸¸ì´ì™€ ê°œìˆ˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  // ì¡°ê±´ì— ë”°ë¥¸ ë‹¨ê°€
  const unitPrice = (length <= 600) ? 150000 : 195000;
  const sideUnitPrice = 80000;

  const bodyCost = count * unitPrice;
  const sideCost = (!isNaN(sideCount) && sideCount > 0) ? sideCount * sideUnitPrice : 0;
  const totalCost = bodyCost + sideCost;

  // âœ… ê²¬ì ì„œì—ëŠ” ëƒ‰ì¥ê³ ì¥ë§Œ í‘œì‹œ (ì¸¡íŒ ì–¸ê¸‰ ì—†ì´ ì´ì•¡ë§Œ í‘œì‹œ)
  const text = `ëƒ‰ì¥ê³ ì¥ ${length}mm Ã— ${count}ê°œ = <strong>${totalCost.toLocaleString()}ì›</strong>`;

  const list = document.getElementById("estimateList");
  const item = document.createElement("div");
  item.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>${text}</span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>
  `;
  list.appendChild(item);
  updateTotalCost();
}
function addCustomEtcToEstimate(name) {
  const item = allMaterials.find(i => i.category === currentCategory && i.name === name);
  const cost = item ? parseInt(item.price) : 100000;  // ì—†ìœ¼ë©´ 100000 ì˜ˆë¹„ê°’
  const list = document.getElementById("estimateList");

  const div = document.createElement("div");
  div.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span>${name} = <strong>${cost.toLocaleString()}ì›</strong></span>
      <button onclick="this.parentElement.remove(); updateTotalCost()" 
        style="background:#888; color:white; border:none; border-radius:3px; padding:2px 6px; cursor:pointer;">X</button>
    </div>
  `;
  list.appendChild(div);
  updateTotalCost();
}

function toggleBestLabel(category, name) {
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      type: "toggleBest",
      category,
      name
    })
  })
  .then(res => res.text())
  .then(msg => {
    alert(msg);
    // ìì¬ ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    if (currentMainCategory === "ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ") {
      loadArtificialMaterials();
    } else if (currentMainCategory === "ìƒë¶€ì¥") {
      loadPanelMaterials("upper", currentCategory);
    } else if (currentMainCategory === "í•˜ë¶€ì¥") {
      loadPanelMaterials("lower", currentCategory);
    } else {
      loadEtcMaterials(currentCategory, `etcMaterialList-${currentSubCategory}`);
    }
  });
}

function toggleBasicLabel(category, name) {
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      type: "toggleBasic",
      category,
      name
    })
  })
  .then(res => res.text())
  .then(msg => {
    alert(msg);
    // ìì¬ ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    if (currentMainCategory === "ì¸ì¡°ëŒ€ë¦¬ì„ìƒíŒ") {
      loadArtificialMaterials();
    } else if (currentMainCategory === "ìƒë¶€ì¥") {
      loadPanelMaterials("upper", currentCategory);
    } else if (currentMainCategory === "í•˜ë¶€ì¥") {
      loadPanelMaterials("lower", currentCategory);
    } else {
      loadEtcMaterials(currentCategory, `etcMaterialList-${currentSubCategory}`);
    }
  });
}
function insertSectionInOrder(section) {
  const estimateList = document.getElementById("estimateList");

  const upperSection = document.getElementById("estimate-upper");
  const lowerSection = document.getElementById("estimate-lower");
  const artSection = document.getElementById("estimate-artificial");

  if (section.id === "estimate-upper") {
    estimateList.insertBefore(section, upperSection || lowerSection || artSection || null);
  } else if (section.id === "estimate-lower") {
    if (artSection) {
      estimateList.insertBefore(section, artSection);
    } else {
      estimateList.appendChild(section);
    }
  } else if (section.id === "estimate-artificial") {
    estimateList.appendChild(section);
  }
}
  </script>
<!-- âœ… ì´ë¯¸ì§€ ëª¨ë‹¬ with ë‹«ê¸° ë²„íŠ¼ -->
<div id="imageModal" style="
  display: none;
  position: fixed;
  z-index: 9999;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.7);
  justify-content: center;
  align-items: center;
">
  <button onclick="closeImageModal()" style="
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 28px;
    background: none;
    color: white;
    border: none;
    cursor: pointer;
  ">âœ•</button>
  <img id="modalImage" src="" style="max-width: 90%; max-height: 90%; border: 6px solid white; border-radius: 8px;" />
</div>

</body>
</html>
